/******************************************************************************************
*
*   MODULE:
*       bump.c
*
*   DESCRIPTION:
*       This file includes bumper related procedures.
*
*   Created by Seongkwan Lee on Oct 27, 2020
*
******************************************************************************************/

/*-----------------------------------------------------------------------------------------
                                     GENERAL INCLUDES
-----------------------------------------------------------------------------------------*/

#include "bump.h"

/*-----------------------------------------------------------------------------------------
                                  DESIGN ASSURANCE LEVEL
-----------------------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------------------
                                         MACROS
-----------------------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------------------
                                    LITERAL CONSTANTS
-----------------------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------------------
                                           TYPES
-----------------------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------------------
                                     MEMORY CONSTANTS
-----------------------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------------------
                                        VARIABLES
-----------------------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------------------
                                       PROCEDURES
-----------------------------------------------------------------------------------------*/


/********************************************************************
*
*   PROCEDURE NAME:
*       bump_init
*
*   DESCRIPTION:
*       Initialize bumper.
*
********************************************************************/

void bump_init
    (
    void
    )
{
P4->SEL0 &= ~0xED;
P4->SEL1 &= ~0xED;
P4->DIR &= ~0xED;
P4->REN |= 0xED;
P4->OUT |= 0xED;

}   /* bump_init() */


/********************************************************************
*
*   PROCEDURE NAME:
*       bump_read
*
*   DESCRIPTION:
*       Read bumper status.
*
********************************************************************/

uint8_t bump_read
    (
    void
    )
{
return( P4->IN & 0xED );

}   /* bump_read() */


/********************************************************************
*
*   PROCEDURE NAME:
*       bump_read_num
*
*   DESCRIPTION:
*       Read one of the bumpers.
*
********************************************************************/

boolean bump_read_num
    (
    uint8_t num
    )
{
return( ( ( P4->IN & 0xED ) & num ) == FALSE );

}   /* bump_read_num() */


/********************************************************************
*
*   PROCEDURE NAME:
*       bump_wait
*
*   DESCRIPTION:
*       Wait for bumper to be pressed and released.
*
********************************************************************/

void bump_wait
    (
    uint8_t num
    )
{
while( ( bump_read() & num ) == TRUE );      // wait for push
while( ( bump_read() & num ) == FALSE );     // wait for release

}   /* bump_wait() */
